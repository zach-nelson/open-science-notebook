<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.49">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Zach Nelson">
<meta name="dcterms.date" content="2022-12-09">
<meta name="description" content="Procedure in R to process monthly volumetric flow data provided by LADWP to ICWD each December to January. Output options include formatting required for OVGA volumetric flow data imports">
<title>Open Science Notebook - Steps to update ICWD’s monthly volumetric flow (pumping, surface water, valley totals and means) database from LADWP water-year data ransfer</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="../../styles.css">
<meta name="citation_title" content="Steps to update ICWD&amp;amp;#039;s monthly volumetric flow (pumping, surface water, valley totals and means) database from LADWP water-year data ransfer">
<meta name="citation_author" content="Zach Nelson">
<meta name="citation_publication_date" content="2022-12-09">
<meta name="citation_cover_date" content="2022-12-09">
<meta name="citation_year" content="2022">
<meta name="citation_online_date" content="2022-12-09">
<meta name="citation_fulltext_html_url" content="https://zach-nelson.github.io/open-science-notebook/posts/monitoring-wells/">
<meta name="citation_volume" content="1">
<meta name="citation_language" content="en">
<meta name="citation_technical_report_institution" content="Inyo County Water Department">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Open Science Notebook</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zach-nelson/open-science-notebook" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#annual-data-transfer" id="toc-annual-data-transfer" class="nav-link active" data-scroll-target="#annual-data-transfer"><span class="toc-section-number">1</span>  Annual Data Transfer</a></li>
  <li><a href="#tidy-data-in-excel" id="toc-tidy-data-in-excel" class="nav-link" data-scroll-target="#tidy-data-in-excel"><span class="toc-section-number">2</span>  Tidy data in Excel</a></li>
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data"><span class="toc-section-number">3</span>  read data</a></li>
  <li><a href="#annual-update" id="toc-annual-update" class="nav-link" data-scroll-target="#annual-update"><span class="toc-section-number">4</span>  annual update</a></li>
  <li><a href="#summary-stations---extra" id="toc-summary-stations---extra" class="nav-link" data-scroll-target="#summary-stations---extra"><span class="toc-section-number">5</span>  summary stations - extra</a></li>
  <li><a href="#merge-all" id="toc-merge-all" class="nav-link" data-scroll-target="#merge-all"><span class="toc-section-number">6</span>  merge all</a></li>
  <li><a href="#roy-wy-irrag-year-functions" id="toc-roy-wy-irrag-year-functions" class="nav-link" data-scroll-target="#roy-wy-irrag-year-functions"><span class="toc-section-number">7</span>  roy, wy, irrag year functions</a></li>
  <li><a href="#merge-old-and-new" id="toc-merge-old-and-new" class="nav-link" data-scroll-target="#merge-old-and-new"><span class="toc-section-number">8</span>  Merge old and new</a></li>
  <li><a href="#process-for-ovga" id="toc-process-for-ovga" class="nav-link" data-scroll-target="#process-for-ovga"><span class="toc-section-number">9</span>  process for OVGA</a></li>
  <li><a href="#flow---ovga-templated-data-export" id="toc-flow---ovga-templated-data-export" class="nav-link" data-scroll-target="#flow---ovga-templated-data-export"><span class="toc-section-number">10</span>  Flow - OVGA templated data export</a></li>
  <li><a href="#production---ovga-templated-export" id="toc-production---ovga-templated-export" class="nav-link" data-scroll-target="#production---ovga-templated-export"><span class="toc-section-number">11</span>  Production - OVGA templated export</a></li>
  <li><a href="#qa" id="toc-qa" class="nav-link" data-scroll-target="#qa"><span class="toc-section-number">12</span>  QA</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Steps to update ICWD’s monthly volumetric flow (pumping, surface water, valley totals and means) database from LADWP water-year data ransfer</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">hydrology</div>
    <div class="quarto-category">monitoring wells</div>
    <div class="quarto-category">LADWP data</div>
    <div class="quarto-category">OVGA</div>
    <div class="quarto-category">time series</div>
  </div>
  </div>

<div>
  <div class="description">
    Procedure in R to process monthly volumetric flow data provided by LADWP to ICWD each December to January. Output options include formatting required for OVGA volumetric flow data imports
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zach Nelson </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 9, 2022</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 18, 2023</p>
    </div>
  </div>
    
  </div>
  

</header><section id="annual-data-transfer" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Annual Data Transfer</h1>
<p>Data from LADWP monitoring well reads, surface water gauging station reads, precipitation reads and aggregated totals and means of these data are typically provided to ICWD in January of each year. This document describes how to process the monitoring wells data and append it to the master database used internally by ICWD and also distributed to other agencies upon request (e.g.&nbsp;Cal Fish and Widlife, Big Pine Environmental Dept, US Fish and Widlife Service, Cal Dept. Water Resources to name a few). The data is also uploaded to the Owens Valley Groundwater Authority (OVGA) data management system and <a href="http://owens.gladata.com/">webmap</a>.</p>
<p>Data is provided to ICWD in the ZRXP format - an ASCII data exchange file format of WISKI. I’ve investigated if tools exist to convert ZRXP format into something resembling human readable long format (aka tidy data), but I have not found anything as of 2022. Therefore I use some clunky yet clever excel tricks to tidy this data in a few minutes using the steps described below. After excel processing, I read this tidied data into R for minimal processing which is then appended to the master database with records from 1924 to present and then the special requirements for the OVGA upload is tackled.</p>
<p>The land surface corrected depth to water reads measured from the reference point (RP) and corrected for RP above ground elevation are included in the file labeled with <code>DepthGE</code>. The measurement from the RP are named <code>DepthRP</code> and water surface elevation included in the <code>DepthWSE</code>.</p>
</section><section id="tidy-data-in-excel" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Tidy data in Excel</h1>
<ol type="1">
<li><p>Open <code>.dat</code> file in excel, in import text wizard, use forward slash ‘/’ as the delimeter.</p></li>
<li><p>Label the unnamed column containing staids as ‘staid’.</p></li>
<li><p>Select the ‘staid’ column, Edit&gt;Go To&gt;Special, Check the Blanks option and press Okay. Under the first row below the first staid, Type (=) key, Up arrow (to select the cell above), holding down the Ctrl key, push Enter and this populates the staid id down the entire staid column.</p></li>
<li><p>select entire sheet, under data&gt;Filter, click the filter dropdown on the data column containing both date and read and use <code>text filter</code> with <code>begins with</code> = ‘20’<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. This will exclude the header information leaving only the dtw reads. Name this column <code>dateread</code>.</p></li>
<li><p>Save the staid and data columns into csv and read into R for further processing.</p></li>
</ol>
<p>The tidied data update is saved to the data/hydro subdirectory e.g <code>'data/hydro/VolumeMonthAF_2021-22.csv'</code>.</p>
<p>There is an excel spreadsheet with sequential worksheets demonstrating this process and an accompanying word doc explaining the steps with screen shots (note: add these here). Since this process need only be done once a year, these references should be helpful in the future if the ZRXP output continues to be the sole format provided by LADWP.</p>
</section><section id="read-data" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> read data</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_b95d543062c2e5d56e54f4b0273025bb">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>rp_elev <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'data'</span>,<span class="st">'hydro'</span>,<span class="st">'rp_elev.csv'</span>))</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#historical data</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>monthlies <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'data'</span>,<span class="st">'hydro'</span>,<span class="st">'totals_means_thru_sep_2021.csv'</span>))<span class="co"># </span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># annual update</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>ann.update <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'data'</span>,<span class="st">'hydro'</span>,<span class="st">'VolumeMonthAF_2021-22.csv'</span>))</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># summary_stations &lt;- 'data/summary_stations19-20.csv'</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>sum_stations <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'data'</span>,<span class="st">'hydro'</span>,<span class="st">'summary_stations21-22.csv'</span>))</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># attribute data from wells database  </span></span>
<span id="cb1-12"><a href="#cb1-12"></a>staid <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'data'</span>,<span class="st">'hydro'</span>,<span class="st">'staid_current.csv'</span>))</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>ovga_points <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'data'</span>,<span class="st">'hydro'</span>,<span class="st">'Owens_Monitoring_Points.csv'</span>))</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co"># ovga_points</span></span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a>production.meta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'data'</span>,<span class="st">'hydro'</span>,<span class="st">'Production.csv'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="fu">select</span>(mon_pt_name, method) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="annual-update" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> annual update</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_accc075b74ca0b0f693ec90d28821249">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#separate the data column and assign numeric class to value</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>ann.update2 <span class="ot">&lt;-</span> ann.update <span class="sc">%&gt;%</span> <span class="fu">separate</span>(dateread, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"read"</span>),<span class="at">sep =</span> <span class="st">" "</span>) </span>
<span id="cb2-3"><a href="#cb2-3"></a>ann.update2<span class="sc">$</span>read <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ann.update2<span class="sc">$</span>read)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>format the date column</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_c3cd853637ef27f66492637a98680151">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># use lubridate package to format the date</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>ann.update2<span class="sc">$</span>datetime <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(ann.update2<span class="sc">$</span>date)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>ann.update3<span class="ot">&lt;-</span>ann.update2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(datetime),</span>
<span id="cb3-6"><a href="#cb3-6"></a>                            <span class="at">month =</span> <span class="fu">month</span>(datetime),</span>
<span id="cb3-7"><a href="#cb3-7"></a>                            <span class="at">month_abbr =</span> <span class="fu">month</span>(datetime, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-8"><a href="#cb3-8"></a>                            <span class="at">day =</span> <span class="fu">mday</span>(datetime),</span>
<span id="cb3-9"><a href="#cb3-9"></a>                            <span class="at">date.y.m.d =</span> <span class="fu">make_date</span>(year, month,day))</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co"># rename the columns</span></span>
<span id="cb3-15"><a href="#cb3-15"></a></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co"># add the long form name for the station</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>ann.update4<span class="ot">&lt;-</span>ann.update3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>date)<span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">date =</span> date.y.m.d)<span class="sc">%&gt;%</span> <span class="fu">left_join</span>(staid, <span class="at">by =</span> <span class="st">'staid'</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(staid,description,read,date,year,month,month_abbr) </span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a>ann.update4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16,428 × 7
   staid description                         read date        year month month…¹
   &lt;chr&gt; &lt;chr&gt;                              &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt;  
 1 132   OAK CREEK (NORTH FORK) SPREADING …     0 2021-10-01  2021    10 Oct    
 2 132   OAK CREEK (NORTH FORK) SPREADING …     0 2021-11-01  2021    11 Nov    
 3 132   OAK CREEK (NORTH FORK) SPREADING …     0 2021-12-01  2021    12 Dec    
 4 132   OAK CREEK (NORTH FORK) SPREADING …     0 2022-01-01  2022     1 Jan    
 5 132   OAK CREEK (NORTH FORK) SPREADING …     0 2022-02-01  2022     2 Feb    
 6 132   OAK CREEK (NORTH FORK) SPREADING …     0 2022-03-01  2022     3 Mar    
 7 132   OAK CREEK (NORTH FORK) SPREADING …     0 2022-04-01  2022     4 Apr    
 8 132   OAK CREEK (NORTH FORK) SPREADING …     0 2022-05-01  2022     5 May    
 9 132   OAK CREEK (NORTH FORK) SPREADING …     0 2022-06-01  2022     6 Jun    
10 132   OAK CREEK (NORTH FORK) SPREADING …     0 2022-07-01  2022     7 Jul    
# … with 16,418 more rows, and abbreviated variable name ¹​month_abbr</code></pre>
</div>
<details><summary>code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># depthRP %&gt;% select(STAID,date.y.m.d,dtw,year,month,day) %&gt;% write_csv('depth.RP.2017.2018zn.csv')</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># ann.update3 %&gt;% distinct(STAID)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>pumping wells and flowing wells staids stay the same name</li>
<li>surface water gauges need an SW prefix before the staid id.</li>
<li>remove the summary stations</li>
</ul></section><section id="summary-stations---extra" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> summary stations - extra</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_188e0ea992aaf2f094d5662bade8dbc9">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>sum_stations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 17
   date      FTC  LOLU  LOOU LORPDU LORPRU LORPTU  LOWU   MBR  MTWP  OLTU  OVFG
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 10/1/21  1160   184    78    585    217   2528  1463  2103  3347  8501  3341
 2 11/1/21     0    62    69    416    -48   1187   688  2466  3455  4067  3472
 3 12/1/21  4494    68    59    369   -316    501   320  2890  2294  2347  3887
 4 1/1/22  15518    76    55    369   -468    344   312  1775  2008  3001  3866
 5 2/1/22   7054    63    62    333   -302    434   279  1413  1803  4040  3662
 6 3/1/22   7518    71    55    607    -83    677    27  2412   574  6054  4057
 7 4/1/22      0    82    56    750    317   1204     0  8275     0  7575  3541
 8 5/1/22     45   126    70    488    991   1674     0 17544     0  8222  3464
 9 6/1/22   2682   163    18    186   2342   2933   224 12053     0  6787  3602
10 7/1/22   4257   176    16    194   3009   3399     4  4707     0  1194  3030
11 8/1/22   5954   149    25    323   1620   2117     0  3409     0   535  3068
12 9/1/22  13067   193     2    648   1503   2372    27  1881     0  6488  2935
# … with 5 more variables: OVGR &lt;dbl&gt;, OVIR &lt;dbl&gt;, OVPW &lt;dbl&gt;, OVR &lt;dbl&gt;,
#   SHTO &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_cb5dee4894bb83442d53a88e77e6583d">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># wide to long format using gather()</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>sstations <span class="ot">&lt;-</span> sum_stations <span class="sc">%&gt;%</span> <span class="fu">gather</span>(staid,read,<span class="sc">-</span>date) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(staid, <span class="at">by =</span> <span class="st">'staid'</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>desc_id)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a>sstations<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">mdy</span>(sstations<span class="sc">$</span>date)</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a>sstations<span class="ot">&lt;-</span>sstations <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb8-8"><a href="#cb8-8"></a>                                <span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb8-9"><a href="#cb8-9"></a>                                <span class="at">month_abbr =</span> <span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a></span>
<span id="cb8-12"><a href="#cb8-12"></a>sstations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 192 × 7
   date       staid  read description                   month  year month_abbr
   &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                         &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt;     
 1 2021-10-01 FTC    1160 L.A.A. TOTAL FLOW TO THE CITY    10  2021 Oct       
 2 2021-11-01 FTC       0 L.A.A. TOTAL FLOW TO THE CITY    11  2021 Nov       
 3 2021-12-01 FTC    4494 L.A.A. TOTAL FLOW TO THE CITY    12  2021 Dec       
 4 2022-01-01 FTC   15518 L.A.A. TOTAL FLOW TO THE CITY     1  2022 Jan       
 5 2022-02-01 FTC    7054 L.A.A. TOTAL FLOW TO THE CITY     2  2022 Feb       
 6 2022-03-01 FTC    7518 L.A.A. TOTAL FLOW TO THE CITY     3  2022 Mar       
 7 2022-04-01 FTC       0 L.A.A. TOTAL FLOW TO THE CITY     4  2022 Apr       
 8 2022-05-01 FTC      45 L.A.A. TOTAL FLOW TO THE CITY     5  2022 May       
 9 2022-06-01 FTC    2682 L.A.A. TOTAL FLOW TO THE CITY     6  2022 Jun       
10 2022-07-01 FTC    4257 L.A.A. TOTAL FLOW TO THE CITY     7  2022 Jul       
# … with 182 more rows</code></pre>
</div>
</div>
</section><section id="merge-all" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> merge all</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_f2516b63e04a0c6eaa85794a304d15b5">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>update.merged <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sstations,ann.update4)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co"># tm_all_merged</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="roy-wy-irrag-year-functions" class="level1" data-number="7"><h1 data-number="7">
<span class="header-section-number">7</span> roy, wy, irrag year functions</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_5c3bbb518a46c4962bdc17edee1d1375">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">#tm master</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>update.merged2 <span class="ot">&lt;-</span> update.merged <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wy =</span> <span class="fu">case_when</span>(month <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">~</span> year <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb11-3"><a href="#cb11-3"></a>                                          month <span class="sc">&lt;=</span> <span class="dv">9</span> <span class="sc">~</span> year),</span>
<span id="cb11-4"><a href="#cb11-4"></a>                           <span class="at">roy =</span> <span class="fu">case_when</span>(month <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">~</span> year <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>                                           month <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">~</span> year),</span>
<span id="cb11-6"><a href="#cb11-6"></a>                           <span class="at">irrag =</span> <span class="fu">case_when</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>) <span class="sc">~</span> year))</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co"># tmm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="merge-old-and-new" class="level1" data-number="8"><h1 data-number="8">
<span class="header-section-number">8</span> Merge old and new</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_cff425f176af5107b03fb93812d64087">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>update.merged3 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(update.merged2, monthlies)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co"># tm_all_merged</span></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a>update.merged3 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 798,857 × 10
   date       staid  read description      month  year month…¹    wy   roy irrag
   &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 2021-10-01 FTC    1160 L.A.A. TOTAL FL…    10  2021 Oct      2022  2021    NA
 2 2021-11-01 FTC       0 L.A.A. TOTAL FL…    11  2021 Nov      2022  2021    NA
 3 2021-12-01 FTC    4494 L.A.A. TOTAL FL…    12  2021 Dec      2022  2021    NA
 4 2022-01-01 FTC   15518 L.A.A. TOTAL FL…     1  2022 Jan      2022  2021    NA
 5 2022-02-01 FTC    7054 L.A.A. TOTAL FL…     2  2022 Feb      2022  2021    NA
 6 2022-03-01 FTC    7518 L.A.A. TOTAL FL…     3  2022 Mar      2022  2021    NA
 7 2022-04-01 FTC       0 L.A.A. TOTAL FL…     4  2022 Apr      2022  2022  2022
 8 2022-05-01 FTC      45 L.A.A. TOTAL FL…     5  2022 May      2022  2022  2022
 9 2022-06-01 FTC    2682 L.A.A. TOTAL FL…     6  2022 Jun      2022  2022  2022
10 2022-07-01 FTC    4257 L.A.A. TOTAL FL…     7  2022 Jul      2022  2022  2022
# … with 798,847 more rows, and abbreviated variable name ¹​month_abbr</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_05cd1f24d321db07dff497e59179a20d">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># update.merged3 %&gt;% write_csv('totals_means_thru_sep_2021.csv')</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>update.merged3 <span class="sc">%&gt;%</span> <span class="fu">write_csv</span>(<span class="st">'output/totals_means_thru_sep_2022.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="process-for-ovga" class="level1" data-number="9"><h1 data-number="9">
<span class="header-section-number">9</span> process for OVGA</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-10_1273dd30f4e91da01b701d9efc000c28">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>tm_process_for_ovga <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"output/totals_means_thru_sep_2022.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_452c2308352575760db66932da593916">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>tm_process_for_ovga <span class="ot">&lt;-</span> update.merged3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>WellName The WellName column is required and must contain the name of a monitoring point within the basin selected when the file was uploaded.</p>
<p>FlowDate The FlowDate column is required. The field must be a date.</p>
<p>FlowRateAcFtPM The FlowRateAcFtPM column is required and must be numeric. Units are in acre-foot per month</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_6db4a1d13dd7b798377c183f4f8a6ec0">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>flow.meta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'data'</span>,<span class="st">'hydro'</span>,<span class="st">'Flows.csv'</span>)) <span class="sc">%&gt;%</span>  <span class="fu">select</span>(mon_pt_name, LADWP_ID) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">staid =</span> <span class="fu">as.character</span>(LADWP_ID)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>LADWP_ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-13_6f310d31fca9efde47c331aeae7aa069">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>tm22 <span class="ot">&lt;-</span> tm_process_for_ovga <span class="sc">%&gt;%</span> <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="st">"2021-09-30"</span> <span class="sc">&amp;</span> read <span class="sc">!=</span> <span class="sc">-</span><span class="dv">777</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a>tm22</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,830 × 10
   date       staid  read description      month  year month…¹    wy   roy irrag
   &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 2021-10-01 FTC    1160 L.A.A. TOTAL FL…    10  2021 Oct      2022  2021    NA
 2 2021-11-01 FTC       0 L.A.A. TOTAL FL…    11  2021 Nov      2022  2021    NA
 3 2021-12-01 FTC    4494 L.A.A. TOTAL FL…    12  2021 Dec      2022  2021    NA
 4 2022-01-01 FTC   15518 L.A.A. TOTAL FL…     1  2022 Jan      2022  2021    NA
 5 2022-02-01 FTC    7054 L.A.A. TOTAL FL…     2  2022 Feb      2022  2021    NA
 6 2022-03-01 FTC    7518 L.A.A. TOTAL FL…     3  2022 Mar      2022  2021    NA
 7 2022-04-01 FTC       0 L.A.A. TOTAL FL…     4  2022 Apr      2022  2022  2022
 8 2022-05-01 FTC      45 L.A.A. TOTAL FL…     5  2022 May      2022  2022  2022
 9 2022-06-01 FTC    2682 L.A.A. TOTAL FL…     6  2022 Jun      2022  2022  2022
10 2022-07-01 FTC    4257 L.A.A. TOTAL FL…     7  2022 Jul      2022  2022  2022
# … with 8,820 more rows, and abbreviated variable name ¹​month_abbr</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_607786b768935c28d4b030ed6e566720">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>flow_ovga <span class="ot">&lt;-</span> tm22 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(flow.meta, <span class="at">by =</span> <span class="st">'staid'</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mon_pt_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-15_41bd38696252a302b1e447d09446e6a8">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>sw.flow <span class="ot">&lt;-</span> flow_ovga  <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">mutate</span>(<span class="at">WellName =</span> mon_pt_name,</span>
<span id="cb21-3"><a href="#cb21-3"></a>         <span class="at">FlowDate =</span> date,</span>
<span id="cb21-4"><a href="#cb21-4"></a>         <span class="at">FlowRateAcFtPM =</span> read,</span>
<span id="cb21-5"><a href="#cb21-5"></a>         <span class="at">FlowRateCFS =</span> <span class="st">""</span>,</span>
<span id="cb21-6"><a href="#cb21-6"></a>         <span class="at">FlowRateGPM =</span> <span class="st">""</span>) </span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a>sw.flow <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="fu">filter</span>(FlowRateAcFtPM <span class="sc">&lt;</span> <span class="dv">600000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="fu">select</span>(WellName,FlowDate,FlowRateAcFtPM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,430 × 3
   WellName FlowDate   FlowRateAcFtPM
   &lt;chr&gt;    &lt;date&gt;              &lt;dbl&gt;
 1 SW0132   2021-10-01              0
 2 SW0132   2021-11-01              0
 3 SW0132   2021-12-01              0
 4 SW0132   2022-01-01              0
 5 SW0132   2022-02-01              0
 6 SW0132   2022-03-01              0
 7 SW0132   2022-04-01              0
 8 SW0132   2022-05-01              0
 9 SW0132   2022-06-01              0
10 SW0132   2022-07-01              0
# … with 6,420 more rows</code></pre>
</div>
</div>
</section><section id="flow---ovga-templated-data-export" class="level1" data-number="10"><h1 data-number="10">
<span class="header-section-number">10</span> Flow - OVGA templated data export</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-16_8fec245db9d83e48b1d7d23ef98400f1">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>sw.flow <span class="sc">%&gt;%</span> <span class="fu">write_csv</span>(<span class="st">"ovga_swflow_import_wy22.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-17_4a385ab3ea3e6350639a51dd8d5f6e71">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># sw_other &lt;- c('T','F','V','W')</span></span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a> </span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co"># filter(read !=-777) %&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  </span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="co"># TFVW_wellnames &lt;- tm_process_for_ovga$staid %&gt;%  unique() %&gt;% </span></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="co">#   str_subset("^[TFVW].")</span></span>
<span id="cb24-8"><a href="#cb24-8"></a></span>
<span id="cb24-9"><a href="#cb24-9"></a></span>
<span id="cb24-10"><a href="#cb24-10"></a></span>
<span id="cb24-11"><a href="#cb24-11"></a></span>
<span id="cb24-12"><a href="#cb24-12"></a>tm_ovga <span class="ot">&lt;-</span> tm22 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(production.meta, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'staid'</span> <span class="ot">=</span> <span class="st">'mon_pt_name'</span>))  </span>
<span id="cb24-13"><a href="#cb24-13"></a></span>
<span id="cb24-14"><a href="#cb24-14"></a></span>
<span id="cb24-15"><a href="#cb24-15"></a></span>
<span id="cb24-16"><a href="#cb24-16"></a><span class="co"># tm_ovga &lt;- tm1721 %&gt;% left_join(production.meta, by = c('staid' = 'mon_pt_name'))  </span></span>
<span id="cb24-17"><a href="#cb24-17"></a></span>
<span id="cb24-18"><a href="#cb24-18"></a></span>
<span id="cb24-19"><a href="#cb24-19"></a><span class="co"># just do anti_join()</span></span>
<span id="cb24-20"><a href="#cb24-20"></a>tm.well.flow <span class="ot">&lt;-</span> tm_ovga <span class="sc">%&gt;%</span> </span>
<span id="cb24-21"><a href="#cb24-21"></a>  <span class="fu">semi_join</span>(production.meta, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'staid'</span><span class="ot">=</span><span class="st">'mon_pt_name'</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb24-22"><a href="#cb24-22"></a>  <span class="fu">mutate</span>(<span class="at">WellName =</span> staid,</span>
<span id="cb24-23"><a href="#cb24-23"></a>         <span class="at">StartDate =</span> date,</span>
<span id="cb24-24"><a href="#cb24-24"></a>         <span class="at">EndDate =</span> <span class="fu">ceiling_date</span>(date,<span class="st">'month'</span>),</span>
<span id="cb24-25"><a href="#cb24-25"></a>         <span class="at">AgUsageAF =</span> <span class="st">''</span>,</span>
<span id="cb24-26"><a href="#cb24-26"></a>         <span class="at">MIUsageAF =</span> read,</span>
<span id="cb24-27"><a href="#cb24-27"></a>         <span class="at">TotalUsageAF =</span> read,</span>
<span id="cb24-28"><a href="#cb24-28"></a>         <span class="at">Method =</span> method,</span>
<span id="cb24-29"><a href="#cb24-29"></a>         <span class="at">Notes =</span> <span class="st">''</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-30"><a href="#cb24-30"></a>  <span class="fu">select</span>(WellName,StartDate,EndDate, AgUsageAF, MIUsageAF, TotalUsageAF, Method, Notes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="production---ovga-templated-export" class="level1" data-number="11"><h1 data-number="11">
<span class="header-section-number">11</span> Production - OVGA templated export</h1>
<div class="cell" data-hash="index_cache/html/ovga-production-export_74f40f36c3b3bb61ecd4526dcb0c77da">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>tm.well.flow.qa <span class="sc">%&gt;%</span> <span class="fu">write_csv</span>(<span class="st">"ovga_production_import_wy18-21.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-19_033efd6998ddfd3e5cec45274a243dbf">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>bad.values <span class="ot">&lt;-</span> </span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">c</span>(<span class="st">'V874'</span>,</span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="st">'F033'</span>,</span>
<span id="cb26-4"><a href="#cb26-4"></a>    <span class="st">'F028'</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co"># tm.well.flow.qa &lt;- tm.well.flow %&gt;% filter(!(WellName %in% bad.values &amp; MIUsageAF &gt; 1000))</span></span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a>tm.well.flow.qa2 <span class="ot">&lt;-</span> tm.well.flow <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>WellName <span class="sc">%in%</span> bad.values <span class="sc">&amp;</span> <span class="sc">!</span>MIUsageAF <span class="sc">&gt;</span> <span class="dv">1000</span>)</span>
<span id="cb26-9"><a href="#cb26-9"></a></span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="co"># unique() %&gt;% #just get the unique() values to drop duplicates for a vector</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>  </span>
<span id="cb26-12"><a href="#cb26-12"></a><span class="co">#above pattern = starts with (^) a T F V or W well ([TFVW]), then anything (.) repeated</span></span>
<span id="cb26-13"><a href="#cb26-13"></a><span class="co">#any number of times (*), then a lower case "a" at the end ($).</span></span>
<span id="cb26-14"><a href="#cb26-14"></a></span>
<span id="cb26-15"><a href="#cb26-15"></a></span>
<span id="cb26-16"><a href="#cb26-16"></a></span>
<span id="cb26-17"><a href="#cb26-17"></a>  <span class="co"># t &lt;- str_which(tm_process_for_ovga$staid, paste(sw_other, collapse="|")) </span></span>
<span id="cb26-18"><a href="#cb26-18"></a> </span>
<span id="cb26-19"><a href="#cb26-19"></a><span class="co"># sw &lt;- tm_process_for_ovga %&gt;% str_subset(staid, '^T') </span></span>
<span id="cb26-20"><a href="#cb26-20"></a></span>
<span id="cb26-21"><a href="#cb26-21"></a><span class="co"># t &lt;- tm_process_for_ovga %&gt;% grepl("\\d+",staid)</span></span>
<span id="cb26-22"><a href="#cb26-22"></a>  <span class="co"># library(stringr)</span></span>
<span id="cb26-23"><a href="#cb26-23"></a> </span>
<span id="cb26-24"><a href="#cb26-24"></a><span class="co"># t &lt;- tm_process_for_ovga %&gt;% filter(str_detect(staid, "\\w"))</span></span>
<span id="cb26-25"><a href="#cb26-25"></a></span>
<span id="cb26-26"><a href="#cb26-26"></a>  </span>
<span id="cb26-27"><a href="#cb26-27"></a>  <span class="co"># stringr::str_detect(sw_other, paste(sw, collapse = "|"))</span></span>
<span id="cb26-28"><a href="#cb26-28"></a></span>
<span id="cb26-29"><a href="#cb26-29"></a></span>
<span id="cb26-30"><a href="#cb26-30"></a><span class="co"># (staid %in% c("T","V","W","F"))</span></span>
<span id="cb26-31"><a href="#cb26-31"></a></span>
<span id="cb26-32"><a href="#cb26-32"></a> <span class="co"># tt &lt;- tm_process_for_ovga %&gt;% semi_join(t)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="qa" class="level1" data-number="12"><h1 data-number="12">
<span class="header-section-number">12</span> QA</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-20_019e53092b9a40e38b0f4566ca0879fc">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># check ovr</span></span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a>update.merged3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(staid <span class="sc">==</span> <span class="st">'SHTO'</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(wy) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 2
      wy     n
   &lt;dbl&gt; &lt;int&gt;
 1  1936    12
 2  1937    12
 3  1938    12
 4  1939    12
 5  1940    12
 6  1941    12
 7  1942    12
 8  1943    12
 9  1944    12
10  1945    12
# … with 77 more rows</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-21_38c5966d13022ff40548cbeab689c792">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>dupes <span class="ot">&lt;-</span> update.merged3 <span class="sc">%&gt;%</span> <span class="fu">get_dupes</span>(staid, date, read) </span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co">#278 duplicates on these columns - half can go away</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="co"># no dulicates found</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>nodupes <span class="ot">&lt;-</span> update.merged3 <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(staid, date, read, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) </span>
<span id="cb29-5"><a href="#cb29-5"></a></span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="co">#798,857</span></span>
<span id="cb29-7"><a href="#cb29-7"></a></span>
<span id="cb29-8"><a href="#cb29-8"></a></span>
<span id="cb29-9"><a href="#cb29-9"></a>month.dupes <span class="ot">&lt;-</span> nodupes <span class="sc">%&gt;%</span> <span class="fu">get_dupes</span>(staid, date,read)</span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="co"># no.dupes</span></span>
<span id="cb29-11"><a href="#cb29-11"></a></span>
<span id="cb29-12"><a href="#cb29-12"></a>no.dupes <span class="ot">&lt;-</span> dupes <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="co"># 0 rows</span></span>
<span id="cb29-14"><a href="#cb29-14"></a></span>
<span id="cb29-15"><a href="#cb29-15"></a>no.dupes <span class="sc">%&gt;%</span> <span class="fu">get_dupes</span>(staid, roy, month, read)</span>
<span id="cb29-16"><a href="#cb29-16"></a>dupes.zread <span class="ot">&lt;-</span> dupes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(read <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-22_49c7cdf224c97abce71f73f6b377ad82">
<details><summary>code</summary><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># can separate out the pumping wells. revisit later</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>pwells.update <span class="ot">&lt;-</span> tmm <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(pwells, <span class="at">by =</span> <span class="st">'staid'</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a>p <span class="ot">&lt;-</span> pwells.update <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(WF))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>this should work for the next 977 years until Y3K<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@report{nelson2022,
  author = {Zach Nelson},
  publisher = {Inyo County Water Department},
  title = {Steps to Update {ICWD’s} Monthly Volumetric Flow (Pumping,
    Surface Water, Valley Totals and Means) Database from {LADWP}
    Water-Year Data Ransfer},
  volume = {1},
  date = {2022-12-09},
  url = {https://zach-nelson.github.io/open-science-notebook/posts/monitoring-wells/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-nelson2022" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Zach Nelson. 2022. <span>“Steps to Update ICWD’s Monthly Volumetric Flow
(Pumping, Surface Water, Valley Totals and Means) Database from LADWP
Water-Year Data Ransfer.”</span> <em>Open Science Notebook</em>. Vol. 1.
Inyo County Water Department. <a href="https://zach-nelson.github.io/open-science-notebook/posts/monitoring-wells/">https://zach-nelson.github.io/open-science-notebook/posts/monitoring-wells/</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>